<!-- Import Polymer -->
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- Define your custom element -->
<polymer-element name="genius-box" attributes="source max-display-items">
    <template>
        <link rel="stylesheet" href="genius-box.css">
        <section id="box-overlay"></section>
        <section id="box-container">
            <section id="box-input">
                <input type="text" id="input" autofocus>
            </section>
            <section id="box-list">
                <template repeat="{{item in items}}">
                    <article on-mouseover="{{changeCurrent}}" on-click="{{fireAction}}" class="{{ {current: item.current} | tokenList}}">
                        <span class="icon {{item.iconClass}}"></span>
                        <span class="title">{{item.title}}</span>
                        <span class="shortcut"></span>
                    </article>
                </template>
            </section>
        </section>
    </template>
    <script>
    Polymer('genius-box', {
        ready: function() {
            var that = this;

            this.items = [
              {iconClass: 'foo', title: 'Foo', current: false},
              {iconClass: 'bar', title: 'Bar', current: false},
              {iconClass: 'baz', title: 'Baz', current: true}
            ];

            // Binding
            this.$.input.onkeyup = function keyBinding(e) {
                // Key down
                if (40 === e.keyCode) {
                    console.log('Down');
                    var currentItem = that.items.reduce(function (memo, item, indexItem) {
                        return item.current ? indexItem : memo;
                    }, 0);

                    if (currentItem + 1 < that.items.length) {
                        that.items[currentItem].current = false;
                        that.items[currentItem + 1].current = true;
                    }
                // Key up
                } else if (38 === e.keyCode) {
                    console.log('Up');
                    var currentItem = that.items.reduce(function (memo, item, indexItem) {
                        return item.current ? indexItem : memo;
                    }, 0);

                    if (currentItem > 0) {
                        that.items[currentItem].current = false;
                        that.items[currentItem - 1].current = true;
                    }
                // Key enter
                } else if (13 === e.keyCode) {
                    console.log('Enter');
                    var currentItem = that.items.reduce(function (memo, item, indexItem) {
                        return item.current ? indexItem : memo;
                    }, 0);

                    console.log('run');
                // Others keys
                } else {
                    console.log('Others');
                }
            }
        },
        // Change current
        changeCurrent: function(e, detail, sender) {
            // Clear all
            this.items.map(function (item) {
                item.current = false;
            });

            // Select current
            var item = e.target.templateInstance.model.item;
            item.current = true;
        },
        fireAction: function(e, detail, sender) {
            // Clear all
            this.items.map(function (item) {
                item.current = false;
            });

            // Select current
            var item = e.target.templateInstance.model.item;
            item.current = true;

            console.log('run');
        }
    });
    </script>
</polymer-element>